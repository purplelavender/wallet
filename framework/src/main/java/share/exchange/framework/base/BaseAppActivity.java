package share.exchange.framework.base;import android.content.Context;import android.graphics.drawable.Drawable;import android.os.Build;import android.os.Bundle;import android.os.PersistableBundle;import android.support.v7.app.AppCompatActivity;import android.view.View;import android.view.ViewGroup;import android.view.WindowManager;import android.widget.FrameLayout;import android.widget.TextView;import butterknife.ButterKnife;import butterknife.Unbinder;import share.exchange.framework.R;import share.exchange.framework.dialog.LoadingProgressDialog;import share.exchange.framework.manager.AppManager;import share.exchange.framework.utils.EnvironmentUtil;import share.exchange.framework.widget.BaseStateLayout;import share.exchange.framework.widget.CommonToast;/** * @ClassName: BaseAppActivity * @Description: 应用Activity的基类 * @Author: ZL * @CreateDate: 2019/08/05 14:31 */public abstract class BaseAppActivity extends AppCompatActivity {    private LoadingProgressDialog mLodingDialog;    protected Unbinder unbinder;    protected final String TAG = this.getClass().getSimpleName();    protected Context mAppContext;    private BaseStateLayout mStateView;    private FrameLayout mToolbar;    private TextView tvBaseTitle;    private TextView tvBaseLeft;    private TextView tvBaseRight;    private FrameLayout mStatebar;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.base_activity);        // Activity加入模拟栈        AppManager.getAppManager().addActivity(this);        mStateView = (BaseStateLayout) findViewById(R.id.state_view);        int layout = getLayoutResId();        if (layout != 0) {            mStateView.addStatLayout(BaseStateLayout.STATE_SUCCESS, layout);        }        View view = mStateView.getStateView(BaseStateLayout.STATE_SUCCESS);        initAppContext();        if (getLayoutResId() > 0) {            setContentView(getLayoutResId());        }        unbinder = ButterKnife.bind(this, view);        // 初始化Toolbar标题栏        initStatebar();        initToolbar();        // 下级正常页面的处理        initView(savedInstanceState);        initEvent();        initCurrentData();    }    /**     * 初始化沉浸式状态栏     */    private void initStatebar() {        mStatebar = (FrameLayout) findViewById(R.id.state_bar);        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {            getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);            mStatebar.setVisibility(View.VISIBLE);            final int statusHeight = EnvironmentUtil.getStatusBarHeight(this);            mStatebar.post(new Runnable() {                @Override                public void run() {                    ViewGroup.LayoutParams params = mStatebar.getLayoutParams();                    params.height = statusHeight;                    mStatebar.setLayoutParams(params);                }            });        }    }    /**     * 初始化Toolbar相关     *     * @return     */    private void initToolbar() {        mToolbar = (FrameLayout) findViewById(R.id.toolbar);        tvBaseTitle = (TextView) findViewById(R.id.tv_title);        tvBaseLeft = (TextView) findViewById(R.id.tv_left);        tvBaseRight = (TextView) findViewById(R.id.tv_right);        // 标题栏左边图标监听        Drawable drawable = getResources().getDrawable(R.drawable.ic_tool_return);        drawable.setBounds(0, 0, drawable.getMinimumWidth(), drawable.getMinimumHeight());        tvBaseLeft.setCompoundDrawables(drawable, null, null, null);        tvBaseLeft.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                onBackPressed();            }        });    }    /**     * 设置Toolbar是否显示     *     * @param isShow     */    public void showTitleBar(Boolean isShow) {        mToolbar.setVisibility(isShow ? View.VISIBLE : View.GONE);    }    /**     * 设置Toolbar标题为文字及监听     *     * @param titleTxt     * @param leftDrawable     * @param rightDrawable     * @param listener     */    public void setToolTitleClick(String titleTxt, Drawable leftDrawable, Drawable rightDrawable, View.OnClickListener listener) {        tvBaseTitle.setText(titleTxt);        if (leftDrawable != null) {            leftDrawable.setBounds(0, 0, leftDrawable.getMinimumWidth(), leftDrawable.getMinimumHeight());        }        if (rightDrawable != null) {            rightDrawable.setBounds(0, 0, rightDrawable.getMinimumWidth(), rightDrawable.getMinimumHeight());        }        tvBaseTitle.setCompoundDrawables(leftDrawable, null, rightDrawable, null);        tvBaseTitle.setCompoundDrawablePadding(EnvironmentUtil.dip2px(mAppContext, 5));        tvBaseTitle.setOnClickListener(listener);    }    /**     * 设置Toolbar左边为文字及监听     *     * @param leftTxt     * @param leftDrawable     * @param rightDrawable     * @param listener     */    public void setToolLeftClick(String leftTxt, Drawable leftDrawable, Drawable rightDrawable, View.OnClickListener listener) {        tvBaseLeft.setText(leftTxt);        if (leftDrawable != null) {            leftDrawable.setBounds(0, 0, leftDrawable.getMinimumWidth(), leftDrawable.getMinimumHeight());        }        if (rightDrawable != null) {            rightDrawable.setBounds(0, 0, rightDrawable.getMinimumWidth(), rightDrawable.getMinimumHeight());        }        tvBaseLeft.setCompoundDrawables(leftDrawable, null, rightDrawable, null);        tvBaseLeft.setCompoundDrawablePadding(EnvironmentUtil.dip2px(mAppContext, 5));        tvBaseLeft.setOnClickListener(listener);    }    /**     * 设置Toolbar右边为文字及监听     *     * @param rightTxt     * @param leftDrawable     * @param rightDrawable     * @param listener     */    public void setToolRightClick(String rightTxt, Drawable leftDrawable, Drawable rightDrawable, View.OnClickListener listener) {        tvBaseRight.setText(rightTxt);        if (leftDrawable != null) {            leftDrawable.setBounds(0, 0, leftDrawable.getMinimumWidth(), leftDrawable.getMinimumHeight());        }        if (rightDrawable != null) {            rightDrawable.setBounds(0, 0, rightDrawable.getMinimumWidth(), rightDrawable.getMinimumHeight());        }        tvBaseRight.setCompoundDrawables(leftDrawable, null, rightDrawable, null);        tvBaseRight.setCompoundDrawablePadding(EnvironmentUtil.dip2px(mAppContext, 5));        tvBaseRight.setOnClickListener(listener);    }    /**     * 显示加载进行中布局     */    protected void showLoadingStateLayout() {        mStateView.showStateView(BaseStateLayout.STATE_LOADING);    }    /**     * 显示加载成功布局     */    protected void showSuccessStateLayout() {        mStateView.showStateView(BaseStateLayout.STATE_SUCCESS);    }    /**     * 显示加载错误/网络出错布局     */    protected void showErrorStateLayout() {        mStateView.showStateView(BaseStateLayout.STATE_ERROR);        mStateView.getStateView(BaseStateLayout.STATE_ERROR).findViewById(R.id.txt_error)                .setOnClickListener(new View.OnClickListener() {                    @Override                    public void onClick(View view) {                        errorLoadData();                    }                });    }    /**     * 显示数据为空布局     */    protected void showEmptyStateLayout() {        mStateView.showStateView(BaseStateLayout.STATE_EMPTY);    }    /**     * 显示需要登录布局     */    protected void showLoginStateLayout() {        mStateView.showStateView(BaseStateLayout.STATE_LOGIN);        mStateView.getStateView(BaseStateLayout.STATE_LOGIN).findViewById(R.id.txt_login)                .setOnClickListener(new View.OnClickListener() {                    @Override                    public void onClick(View view) {                        goLoginActivity();                    }                });    }    protected boolean isLoginStateLayout() {        return mStateView.getCurrentState() == BaseStateLayout.STATE_LOGIN;    }    protected void goLoginActivity() {    }    protected void errorLoadData() {    }    /**     * 布局文件资源ID     */    protected abstract int getLayoutResId();    /**     * 负责有关handler等对象,界面ui组件的初始化     */    protected abstract void initView(Bundle savedInstanceState);    /**     * 负责有关界面ui组件事件的初始化     */    protected abstract void initEvent();    /**     * 加载需要第一时间请求的网络数据     */    protected abstract void initCurrentData();    /**     * 恢复当前activity     */    @Override    protected void onResume() {        super.onResume();    }    @Override    protected void onPause() {        super.onPause();    }    @Override    protected void onDestroy() {        // 结束Activity&从堆栈中移除        AppManager.getAppManager().removeActivity(this);        super.onDestroy();        if (null != unbinder) {            unbinder.unbind();        }    }    @Override    public void onSaveInstanceState(Bundle outState, PersistableBundle outPersistentState) {        super.onSaveInstanceState(outState, outPersistentState);    }    @Override    protected void onRestoreInstanceState(Bundle savedInstanceState) {        super.onRestoreInstanceState(savedInstanceState);        initAppContext();    }    /**     * 返回按键     */    @Override    public void onBackPressed() {        super.onBackPressed();    }    /**     * 网络是否可用     */    public boolean hasNetwork() {        return EnvironmentUtil.isNetworkConnected(this);    }    protected void initAppContext() {        try {            this.mAppContext = getApplicationContext();        } catch (Exception e) {        }    }    /**     * @param toastType 提示类型     * @param message   提示文字     */    public void showToast(CommonToast.ToastType toastType, String message) {        if (!this.isFinishing()) {            CommonToast.showToast(this, toastType, message);        }    }    /**     * @param message     * @param cancelable     * @description 显示加载提示     */    public void showLoading(String message, boolean cancelable) {        if (!this.isFinishing()) {            if (null == mLodingDialog) {                this.mLodingDialog = new LoadingProgressDialog(this);            }            mLodingDialog.show();            mLodingDialog.setMessage(message);            mLodingDialog.setCancelable(cancelable);        }    }    /**     * @param message     * @description 显示加载提示     */    public void showLoading(String message) {        showLoading(message, true);    }    /**     * @description 隐藏加载提示     */    public void hideLoading() {        if (null != mLodingDialog && !this.isFinishing()) {            mLodingDialog.dismiss();            mLodingDialog = null;        }    }}